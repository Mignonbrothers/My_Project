<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚ ì”¨ ì˜ˆë³´</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 800px; margin: 32px auto; padding: 0 16px; }
    .card { border: 1px solid #eee; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    .row { display:flex; align-items:center; gap:12px; }
    .muted { color:#666; }
    img.graph { width:100%; max-width:100%; height:auto; border-radius: 8px; border:1px solid #eee; }
    a { text-decoration:none; }

    /* ì¤„ ê°„ê²© ì†Œí­ í™•ëŒ€ */
    .card p, .card li { line-height: 1.6; }

    /* ì„¸ì°¨ ì ìˆ˜ í‘œì‹œ */
    .score-text { margin: 0; font-size: 24px; font-weight: bold; }
    .score-good { color: #1d8f35; } /* ì´ˆë¡ */
    .score-ok   { color: #e4a80e; } /* ë…¸ë‘ */
    .score-bad  { color: #c73535; } /* ë¹¨ê°• */

    /* AQI ë°°ì§€ */
    .badge { display:inline-block; padding:4px 8px; border-radius:8px; font-size:12px; color:#fff; }
    .badge-good     { background:#2e7d32; }  /* 1 ì¢‹ìŒ */
    .badge-fair     { background:#558b2f; }  /* 2 ë³´í†µ */
    .badge-moderate { background:#f9a825; }  /* 3 ì•½ê°„ ë‚˜ì¨ */
    .badge-poor     { background:#ef6c00; }  /* 4 ë‚˜ì¨ */
    .badge-verypoor { background:#c62828; }  /* 5 ë§¤ìš° ë‚˜ì¨ */
  </style>
</head>
<body>
  <a href="/">â† ë©”ì¸ìœ¼ë¡œ</a>
  <h1>ì „ ì„¸ê³„ ë„ì‹œ ë‚ ì”¨ ì˜ˆë³´</h1>

  <form method="POST" class="card">
    <label for="city">ë„ì‹œ ì´ë¦„</label><br/>
    <input id="city" name="city" placeholder="ì˜ˆ: Tokyo, Paris, New York" required style="width:70%; padding:8px;">
    <button type="submit" style="padding:8px 12px;">ì¡°íšŒ</button>
    <p class="muted">ë„ì‹œë§Œ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤. (ì¢Œí‘œ ìë™ íƒìƒ‰)</p>
  </form>

  {% if error %}
    <div class="card" style="border-color:#f2a2a2; background:#fff8f8;">ì˜¤ë¥˜: {{ error }}</div>
  {% endif %}

  {% if weather %}
    <div class="card">
      <div class="row">
        <img src="{{ weather.icon_url }}" alt="í˜„ì¬ ë‚ ì”¨ ì•„ì´ì½˜" width="64" height="64">
        <div>
          <h2 style="margin:0;">{{ weather.city }} ({{ weather.country }})</h2>
          <div class="muted">{{ weather.desc }}</div>
          <div style="font-size:20px; font-weight:600;">{{ "%.1f"|format(weather.temp) }}Â°C</div>

          {# AQI ë°°ì§€ (ëŒ€ê¸°ì§ˆ ì •ë³´ê°€ ìˆì„ ë•Œë§Œ) #}
          {% if weather.air %}
            {% set aqi = weather.air.main.aqi %}
            {% set aqi_class = 'badge-good' %}
            {% set aqi_text = 'ì¢‹ìŒ' %}
            {% if aqi == 2 %}{% set aqi_class = 'badge-fair' %}{% set aqi_text = 'ë³´í†µ' %}{% endif %}
            {% if aqi == 3 %}{% set aqi_class = 'badge-moderate' %}{% set aqi_text = 'ì•½ê°„ ë‚˜ì¨' %}{% endif %}
            {% if aqi == 4 %}{% set aqi_class = 'badge-poor' %}{% set aqi_text = 'ë‚˜ì¨' %}{% endif %}
            {% if aqi == 5 %}{% set aqi_class = 'badge-verypoor' %}{% set aqi_text = 'ë§¤ìš° ë‚˜ì¨' %}{% endif %}
            <div style="margin-top:6px;">
              <span class="badge {{ aqi_class }}">ê³µê¸°ì§ˆ {{ aqi_text }} (AQI {{ aqi }})</span>
              {% if weather.air.components and weather.air.components.pm2_5 is defined %}
                <span class="muted" style="margin-left:8px;">PM2.5: {{ "%.1f"|format(weather.air.components.pm2_5) }}Âµg/mÂ³</span>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div style="height:16px;"></div>

    <div class="card">
      <h3 style="margin-top:0;">5ì¼ ê¸°ì˜¨(í‰ê· /ìµœê³ /ìµœì €)</h3>
      <a href="{{ url_for('static', filename=weather.graph) }}" target="_blank" rel="noopener">
        <img class="graph"
             src="{{ url_for('static', filename=weather.graph) }}?ts={{ range(1,999999)|random }}"
             alt="ì˜ˆë³´ ê·¸ë˜í”„" style="cursor:pointer;">
      </a>
    </div>
  {% endif %}

  <div style="height:16px;"></div>

  {% if weather and weather.convenience %}
    <div class="card">
      <h3 style="margin-top:0;">ìƒí™œ í¸ì˜</h3>

      <div style="display:flex; gap:16px; flex-wrap:wrap;">
        <!-- ì„¸ì°¨ ì§€ìˆ˜ -->
        <div class="card" style="flex:1; min-width:260px;">
          <h4 style="margin:0 0 8px;">ì„¸ì°¨ ì§€ìˆ˜</h4>

          {% set score = weather.convenience.carwash.score %}
          {% if score >= 80 %}
            {% set score_icon = 'âœ¨' %}{% set score_class = 'score-good' %}
          {% elif score >= 50 %}
            {% set score_icon = 'ğŸ‘' %}{% set score_class = 'score-ok' %}
          {% else %}
            {% set score_icon = 'ğŸ‘' %}{% set score_class = 'score-bad' %}
          {% endif %}

          <p class="score-text {{ score_class }}">
            {{ score_icon }} {{ score }}ì 
          </p>
          {% if score >= 80 %}
            <p class="muted" style="margin:4px 0 0;">ì„¸ì°¨í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì”¨ì˜ˆìš”!</p>
          {% elif score >= 50 %}
            <p class="muted" style="margin:4px 0 0;">ë¬´ë‚œí•˜ì§€ë§Œ, ë°”ëŒ/ë¨¼ì§€ì— ìœ ì˜í•˜ì„¸ìš”.</p>
          {% else %}
            <p class="muted" style="margin:4px 0 0;">ì˜¤ëŠ˜ì€ ì„¸ì°¨ë¥¼ ë¯¸ë£¨ëŠ” ê²Œ ì¢‹ì•„ìš”.</p>
          {% endif %}

          <ul style="margin:8px 0 0; padding-left: 18px; font-size: 14px; color: #666;">
            {% for r in weather.convenience.carwash.reasons %}
              <li>{{ r }}</li>
            {% endfor %}
          </ul>
        </div>

        <!-- ì£¼ì°¨ íŒ -->
        <div class="card" style="flex:1; min-width:260px;">
          <h4 style="margin:0 0 8px;">ì£¼ì°¨ íŒ</h4>

          {% set pk = weather.convenience.parking.tip %}
          {% if 'ì‹¤ë‚´' in pk %}
            {% set pk_icon = 'ğŸ ' %}
          {% else %}
            {% set pk_icon = 'ğŸ…¿ï¸' %}
          {% endif %}

          <p style="margin:0;">
            <strong>{{ pk_icon }} {{ weather.convenience.parking.tip }}</strong>
          </p>

          <ul style="margin:6px 0 0 18px;">
            {% for r in weather.convenience.parking.reasons %}
              <li>
                {% if 'ê°•í’' in r %}ğŸ’¨{% elif 'ê°•ìˆ˜' in r or 'ì ì„¤' in r %}ğŸŒ§ï¸{% elif 'ì—†ìŒ' in r %}âœ…{% else %}â€¢{% endif %}
                {{ " " ~ r }}
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  {% endif %}

</body>
</html>
